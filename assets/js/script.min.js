window.CMB2Ext=window.CMB2Ext||{},function(window,document,$,cmbExt,cmb,undefined){"use strict";var $document,setTimeout=window.setTimeout,$id=function(selector){return $(document.getElementById(selector))};cmbExt.$id=$id;var defaults={};cmbExt.init=function(){$document=$(document),$.extend(cmbExt,defaults);var $metabox=cmb.metabox(),$repeatGroup=$metabox.find(".cmb-repeatable-group");cmbExt.makeListSortable(),cmbExt.initAjaxSearch(),cmbExt.initFont(),cmbExt.initSlider(),cmbExt.initIcon(),cmbExt.initMap(),$(".cmb-ext-tab-nav").on("click",".cmb-ext-tab-nav-menu",cmbExt.toggleTabNav),$(document).on("widget-updated widget-added",cmbExt.makeListSortable).on("widget-updated widget-added",cmbExt.initAjaxSearch),$($metabox).on("click",".cmb2-ext-buttonset-label",cmbExt.toggleButtonSelect).on("click",".cmb-ext-content-wrap-field-switch .button",cmbExt.initContentWrap).on("click",'ul.cmb-image-select-list li input[type="radio"]',cmbExt.triggerImageSelect).on("change.cmbAnimation",".cmb-type-animation select",cmbExt.animateOnChange).on("click",".cmb-ext-ajax-search-results a.remover",cmbExt.ajax_search_remove_listener).on("click.cmbAnimationPreview",".cmb-type-animation .cmb-ext-animation-preview-button",cmbExt.animateOnClick).on("click",".cmb-add-row-button",cmbExt.RepeatableFontIconDestroy),$(".cmb-repeat-table").on("click","cmb2_add_row",cmbExt.RepeatableFontIconRefresh).on("click","cmb2_add_row",cmbExt.RepeatableSliderRefresh).on("click","cmb2_add_row",cmbExt.RepeatableMapRefresh),$repeatGroup.length&&$repeatGroup.on("cmb2_add_row",cmbExt.initAjaxSearchGroup).on("cmb2_add_group_row_start",cmbExt.FontIconAddGroupDestroy).on("cmb2_shift_rows_start",cmbExt.FontIconAddGroupShiftedDestroy).on("cmb2_shift_rows_complete",cmbExt.FontIconAddGroupShiftedRefresh).on("cmb2_shift_rows_complete",cmbExt.SliderAddGroupShiftedRefresh).on("cmb2_add_row",cmbExt.FontIconAddGroupRefresh)},cmbExt.toggleTabNav=function(e){e.preventDefault();var $li=$(this).parent(),panel=$li.data("panel"),$wrapper=$li.parents(".cmb-tabs").find(".cmb-tabs-panel"),$panel=$wrapper.find(".cmb-tab-panel-"+panel);$li.addClass("cmb-tab-active").siblings().removeClass("cmb-tab-active"),$panel.siblings().removeClass("show"),$panel.each(function(){$(this).addClass("show")})},cmbExt.initContentWrap=function(e){e.preventDefault();var wrap=$(this).closest(".cmb-ext-content-wrap");wrap.find("input").val(""),wrap.hasClass("cmb-ext-content-wrap-multiple")?(wrap.removeClass("cmb-ext-content-wrap-multiple").addClass("cmb-ext-content-wrap-single"),$(this).find("i").attr("class","dashicons dash","s-editor-expand")):(wrap.removeClass("cmb-ext-content-wrap-single").addClass("cmb-ext-content-wrap-multiple"),$(this).find("i").attr("class","dashicons dashicons-editor-contract"))},cmbExt.animateOnChange=function(){var $this=$(this),text=$this.closest(".cmb-ext-animation").find(".cmb-ext-animation-preview-text");text.length&&(text.attr("class","cmb-ext-animation-preview-text animated"),text.addClass($(this).val()))},cmbExt.animateOnClick=function(){var $this=$(this),text=$this.next(".cmb-ext-animation-preview-text"),animation=text.attr("class").replace("cmb-ext-animation-preview-text",""),select_val=$this.prev("select").val();if(""===animation&&""===select_val)return!1;""!==select_val&&(animation=select_val+" animated"),text.attr("class","cmb-ext-animation-preview-text"),setTimeout(function(){text.addClass(animation)},100)},cmbExt.makeListSortable=function(){var $list=cmb.$metabox.find(".sortable-list-ext");$list.length&&$list.sortable({handle:"span",placeholder:"ui-state-highlight",forcePlaceholderSize:!0}).disableSelection()},cmbExt.triggerImageSelect=function(e){e.stopPropagation();var parent=$(this).closest("ul");$(".cmb-image-select-selected",parent).removeClass("cmb-image-select-selected"),$(this).parent().closest("li").addClass("cmb-image-select-selected")},cmbExt.toggleButtonSelect=function(){var parent=$(this).parents(".cmb2-ext-buttonset");$(".cmb2-ext-buttonset-label",parent).removeClass("selected"),$(this).addClass("selected")},cmbExt.initFont=function(){$(".cmb-type-font select").each(function(){$(this).higooglefonts({theme:"default cmb-ext-font-select2",loadedCallback:function(font){$(".font-preview").css("font-family",font)}})})};var maps=[];cmbExt.initMap=function(){$(".cmb-type-map ").each(function(){cmbExt.singleMap($(this))})},cmbExt.singleMap=function(mapInstance){if(void 0===window.mapsCallback){var searchInput=mapInstance.find(".cmb-map-search"),mapCanvas=mapInstance.find(".cmb-map"),latitude=mapInstance.find(".cmb-map-latitude"),longitude=mapInstance.find(".cmb-map-longitude"),latLng=new google.maps.LatLng(54.800685,-4.130859),zoom=5;latitude.val().length>0&&longitude.val().length>0&&(latLng=new google.maps.LatLng(latitude.val(),longitude.val()),zoom=17);var mapOptions={center:latLng,zoom:zoom},map=new google.maps.Map(mapCanvas[0],mapOptions),markerOptions={map:map,draggable:!0,title:"Drag to set the exact location"},marker=new google.maps.Marker(markerOptions);latitude.val().length>0&&longitude.val().length>0&&marker.setPosition(latLng);var autocomplete=new google.maps.places.Autocomplete(searchInput[0]);autocomplete.bindTo("bounds",map),google.maps.event.addListener(autocomplete,"place_changed",function(){var place=autocomplete.getPlace();place.geometry&&(place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setPosition(place.geometry.location),latitude.val(place.geometry.location.lat()),longitude.val(place.geometry.location.lng()))}),$(searchInput).keypress(function(event){13===event.keyCode&&event.preventDefault()}),google.maps.event.addListener(marker,"drag",function(){latitude.val(marker.getPosition().lat()),longitude.val(marker.getPosition().lng())}),maps.push(map)}},"undefined"!=typeof postboxes&&(postboxes.pbshow=function(){for(var arrayLength=maps.length,i=0;i<arrayLength;i++){var mapCenter=maps[i].getCenter();google.maps.event.trigger(maps[i],"resize"),maps[i].setCenter(mapCenter)}}),cmbExt.RepeatableMapRefresh=function(event,newRow){$(newRow).closest(".cmb-repeatable-group").find(".cmb-type-map").each(function(){cmbExt.singleMap($(this))})},cmbExt.initSlider=function(){$(".cmb-type-slider ").each(function(){cmbExt.slide($(this))})},cmbExt.slide=function(row){row.each(function(){var $this=$(this),$value=$this.find(".cmb-slider-field-value"),$slider=$this.find(".cmb-slider-field"),$text=$this.find(".cmb-slider-field-value-text"),slider_data=$value.data();$slider.slider({range:"min",value:slider_data.start,min:slider_data.min,max:slider_data.max,step:slider_data.step,slide:function(event,ui){$value.val(ui.value),$text.text(ui.value)}}),$value.val($slider.slider("value")),$text.text($slider.slider("value"))})},cmbExt.SliderAddGroupShiftedRefresh=function(event,instance){$(instance).closest(".cmb-repeatable-group").find(".cmb-type-slider").each(function(){$(this).find(".cmb-slider-field").slider("value",$(this).find(".cmb-slider-field-value").val()),$(this).find(".cmb-slider-field-value-text").text($(this).find(".cmb-slider-field-value").val())})},cmbExt.RepeatableSliderRefresh=function(event,newRow){$(newRow).prev().find(".cmb-type-slider").each(function(){cmbExt.initSlider($(this)),$(this).find(".ui-slider-range").css("width",0),$(this).find(".cmb-slider-field").slider("value",0),$(this).find(".cmb-slider-field-value-text").text("0")})},cmbExt.initIcon=function(){$(".cmb-ext-iconselect").each(function(){$(this).fontIconPicker({theme:"fip-grey"})})},cmbExt.RepeatableFontIconDestroy=function(event){$(document.getElementById($(event.target).data("selector"))).find(".cmb-row").last().find(".cmb-ext-iconselect").each(function(){$(this).fontIconPicker().destroyPicker()})},cmbExt.RepeatableFontIconRefresh=function(event,newRow){$(newRow).prev().find(".cmb-ext-iconselect").each(function(){$("option:selected",this).removeAttr("selected"),$(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},cmbExt.FontIconAddGroupDestroy=function(event,instance){$(document.getElementById($(instance).data("selector"))).find(".cmb-repeatable-grouping").last().find(".cmb-ext-iconselect").each(function(){$(this).fontIconPicker().destroyPicker()})},cmbExt.FontIconAddGroupShiftedDestroy=function(event,instance){$(instance).closest(".cmb-repeatable-group").find(".cmb-ext-iconselect").each(function(){$(this).fontIconPicker().destroyPicker()})},cmbExt.FontIconAddGroupRefresh=function(event,newRow){$(newRow).find(".cmb-ext-iconselect").each(function(){$("option:selected",this).removeAttr("selected"),$(this).fontIconPicker().refreshPicker({theme:"fip-grey"})}),$(newRow).prev().find(".cmb-ext-iconselect").each(function(){$(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},cmbExt.FontIconAddGroupShiftedRefresh=function(event,instance){$(instance).closest(".cmb-repeatable-group").find(".cmb-ext-iconselect").each(function(){$(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},cmbExt.initAjaxSearch=function(){$('.cmb-ext-ajax-search:not([data-ajax-search="true"])').each(function(){$(this).attr("data-ajax-search",!0);var field_id=$(this).attr("id").replace(new RegExp("_input$"),""),object_type=$(this).attr("data-object-type"),query_args=$(this).attr("data-query-args");$(this).devbridgeAutocomplete(Object.assign({serviceUrl:cmb2_ext_l10.ajaxurl,type:"POST",triggerSelectOnValidInput:!1,showNoSuggestionNotice:!0,params:{action:"cmb_ajax_search_get_results",nonce:cmb2_ext_l10.nonce,field_id:field_id,object_type:object_type,query_args:query_args},transformResult:function(results){var suggestions=$.parseJSON(results);if($("#"+field_id+"_results li").length){var selected_vals=[],d=0;$("#"+field_id+"_results input").each(function(){selected_vals.push($(this).val())}),$(suggestions).each(function(index,suggestion){$.inArray(suggestion.id.toString(),selected_vals)>-1&&(suggestions.splice(index-d,1),d++)})}return{suggestions:suggestions}},onSearchStart:function(){$(this).next("img.cmb-ext-ajax-search-spinner").css("display","inline-block")},onSearchComplete:function(){$(this).next("img.cmb-ext-ajax-search-spinner").hide()},onSelect:function(suggestion){$(this).devbridgeAutocomplete("clearCache");var field_name=$(this).attr("id").replace(new RegExp("_input$"),""),multiple=$(this).attr("data-multiple"),limit=parseInt($(this).attr("data-limit")),sortable=$(this).attr("data-sortable");1===multiple?($("#"+field_name+"_results").append("<li>"+(1===sortable?'<span class="hndl"></span>':"")+'<input type="hidden" name="'+field_name+'[]" value="'+suggestion.id+'"><a href="'+suggestion.link+'" target="_blank" class="edit-link">'+suggestion.value+'</a><a class="remover"><span class="dashicons dashicons-no"></span><span class="dashicons dashicons-dismiss"></span></a></li>'),$(this).val(""),limit>0&&limit===$("#"+field_name+"_results li").length?$(this).prop("disabled","disabled"):$(this).focus()):$("input[name="+field_name+"]").val(suggestion.id).change()}},cmb2_ext_l10.options)),1===$(this).attr("data-sortable")&&$("#"+field_id+"_results").sortable({handle:".hndl",placeholder:"ui-state-highlight",forcePlaceholderSize:!0})})},cmbExt.initAjaxSearchGroup=function(evt,$row){$row.find(".cmb-ext-ajax-search").attr("data-ajax-search",!1),cmbExt.initAjaxSearch()},cmbExt.ajax_search_remove_listener=function(){$(this).parent("li").fadeOut(400,function(){var field_id=$(this).parents("ul").attr("id").replace("_results","");$("#"+field_id).removeProp("disabled"),$("#"+field_id).devbridgeAutocomplete("clearCache"),$(this).remove()})},$(cmbExt.init)}(window,document,jQuery,window.CMB2Ext,window.CMB2);