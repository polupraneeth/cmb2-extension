window.CMB2Ext=window.CMB2Ext||{},function(e,n,c,a,i){"use strict";e.cmb2_ext_l10;var s=e.setTimeout;a.$id=function(e){return c(n.getElementById(e))};var o={};a.init=function(){c(n),c.extend(a,o);var e=i.metabox(),t=e.find(".cmb-repeatable-group");a.makeListSortable(),a.initAjaxSearch(),a.initFont(),a.initIcon(),c(".cmb-ext-tab-nav").on("click",".cmb-ext-tab-nav-menu",a.toggleTabNav),c(n).on("widget-updated widget-added",a.makeListSortable).on("widget-updated widget-added",a.initAjaxSearch),c(e).on("click",".cmb2-ext-buttonset-label",a.toggleButtonSelect).on("click",".cmb-ext-content-wrap-field-switch .button",a.initContentWrap).on("click",'ul.cmb-image-select-list li input[type="radio"]',a.triggerImageSelect).on("change.cmbAnimation",".cmb-type-animation select",a.animateOnChange).on("click",".cmb-ext-ajax-search-results a.remover",a.ajax_search_remove_listener).on("click.cmbAnimationPreview",".cmb-type-animation .cmb-ext-animation-preview-button",a.animateOnClick).on("click",".cmb-add-row-button",a.RepeatableFontIconDestroy),c(".cmb-repeat-table").on("click","cmb2_add_row",a.RepeatableFontIconRefresh),t.length&&t.on("cmb2_add_row",a.initAjaxSearchGroup).on("cmb2_add_group_row_start",a.FontIconAddGroupDestroy).on("cmb2_shift_rows_start",a.FontIconAddGroupShiftedDestroy).on("cmb2_shift_rows_complete",a.FontIconAddGroupShiftedRefresh).on("cmb2_add_row",a.FontIconAddGroupRefresh)},a.toggleTabNav=function(e){e.preventDefault();var t=c(this).parent(),n=t.data("panel"),a=t.parents(".cmb-tabs").find(".cmb-tabs-panel").find(".cmb-tab-panel-"+n);t.addClass("cmb-tab-active").siblings().removeClass("cmb-tab-active"),a.siblings().removeClass("show"),a.each(function(){c(this).addClass("show")})},a.initContentWrap=function(e){e.preventDefault();var t=c(this).closest(".cmb-ext-content-wrap");t.find("input").val(""),t.hasClass("cmb-ext-content-wrap-multiple")?(t.removeClass("cmb-ext-content-wrap-multiple").addClass("cmb-ext-content-wrap-single"),c(this).find("i").attr("class","dashicons dashicons-editor-expand")):(t.removeClass("cmb-ext-content-wrap-single").addClass("cmb-ext-content-wrap-multiple"),c(this).find("i").attr("class","dashicons dashicons-editor-contract"))},a.animateOnChange=function(e){var t=c(this).closest(".cmb-ext-animation").find(".cmb-ext-animation-preview-text");t.length&&(t.attr("class","cmb-ext-animation-preview-text animated"),t.addClass(c(this).val()))},a.animateOnClick=function(e){var t=c(this),n=t.next(".cmb-ext-animation-preview-text"),a=n.attr("class").replace("cmb-ext-animation-preview-text",""),i=t.prev("select").val();if(""===a&&""===i)return!1;""!==i&&(a=i+" animated"),n.attr("class","cmb-ext-animation-preview-text"),s(function(){n.addClass(a)},100)},a.makeListSortable=function(){var e=i.$metabox.find(".sortable-list-ext");e.length&&e.sortable({handle:"span",placeholder:"ui-state-highlight",forcePlaceholderSize:!0}).disableSelection()},a.triggerImageSelect=function(e){e.stopPropagation();var t=c(this).closest("ul");c(".cmb-image-select-selected",t).removeClass("cmb-image-select-selected"),c(this).parent().closest("li").addClass("cmb-image-select-selected")},a.toggleButtonSelect=function(){var e=c(this).parents(".cmb2-ext-buttonset");c(".cmb2-ext-buttonset-label",e).removeClass("selected"),c(this).addClass("selected")},a.initFont=function(){c(".cmb-type-font select").each(function(){c(this).higooglefonts({theme:"default cmb-ext-font-select2",selectedCallback:function(e){},loadedCallback:function(e){c(".font-preview").css("font-family",e)}})})},a.initIcon=function(){c(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker({theme:"fip-grey"})})},a.RepeatableFontIconDestroy=function(e){c(n.getElementById(c(e.target).data("selector"))).find(".cmb-row").last().find(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker().destroyPicker()})},a.RepeatableFontIconRefresh=function(e,t){c(t).prev().find(".cmb-ext-iconselect").each(function(){c("option:selected",this).removeAttr("selected"),c(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},a.FontIconAddGroupDestroy=function(e,t){c(n.getElementById(c(t).data("selector"))).find(".cmb-repeatable-grouping").last().find(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker().destroyPicker()})},a.FontIconAddGroupShiftedDestroy=function(e,t){c(t).closest(".cmb-repeatable-group").find(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker().destroyPicker()})},a.FontIconAddGroupRefresh=function(e,t){c(t).find(".cmb-ext-iconselect").each(function(){c("option:selected",this).removeAttr("selected"),c(this).fontIconPicker().refreshPicker({theme:"fip-grey"})}),c(t).prev().find(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},a.FontIconAddGroupShiftedRefresh=function(e,t){c(t).closest(".cmb-repeatable-group").find(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},a.initAjaxSearch=function(){c('.cmb-ext-ajax-search:not([data-ajax-search="true"])').each(function(){c(this).attr("data-ajax-search",!0);c(this).attr("id");var t=c(this).attr("id").replace(new RegExp("_input$"),""),e=c(this).attr("data-object-type"),n=c(this).attr("data-query-args");c(this).devbridgeAutocomplete(Object.assign({serviceUrl:cmb2_ext_l10.ajaxurl,type:"POST",triggerSelectOnValidInput:!1,showNoSuggestionNotice:!0,params:{action:"cmb_ajax_search_get_results",nonce:cmb2_ext_l10.nonce,field_id:t,object_type:e,query_args:n},transformResult:function(e){var n=c.parseJSON(e);if(c("#"+t+"_results li").length){var a=[],i=0;c("#"+t+"_results input").each(function(e,t){a.push(c(this).val())}),c(n).each(function(e,t){-1<c.inArray(t.id.toString(),a)&&(n.splice(e-i,1),i++)})}return{suggestions:n}},onSearchStart:function(){c(this).next("img.cmb-ext-ajax-search-spinner").css("display","inline-block")},onSearchComplete:function(){c(this).next("img.cmb-ext-ajax-search-spinner").hide()},onSelect:function(e){c(this).devbridgeAutocomplete("clearCache");var t=c(this).attr("id").replace(new RegExp("_input$"),""),n=c(this).attr("data-multiple"),a=parseInt(c(this).attr("data-limit")),i=c(this).attr("data-sortable");1==n?(c("#"+t+"_results").append("<li>"+(1==i?'<span class="hndl"></span>':"")+'<input type="hidden" name="'+t+'[]" value="'+e.id+'"><a href="'+e.link+'" target="_blank" class="edit-link">'+e.value+'</a><a class="remover"><span class="dashicons dashicons-no"></span><span class="dashicons dashicons-dismiss"></span></a></li>'),c(this).val(""),0<a&&a==c("#"+t+"_results li").length?c(this).prop("disabled","disabled"):c(this).focus()):c("input[name="+t+"]").val(e.id).change()}},cmb2_ext_l10.options)),1==c(this).attr("data-sortable")&&c("#"+t+"_results").sortable({handle:".hndl",placeholder:"ui-state-highlight",forcePlaceholderSize:!0})})},a.initAjaxSearchGroup=function(e,t){t.find(".cmb-ext-ajax-search").attr("data-ajax-search",!1),a.initAjaxSearch()},a.ajax_search_remove_listener=function(){c(this).parent("li").fadeOut(400,function(){var e=c(this).parents("ul").attr("id").replace("_results","");c("#"+e).removeProp("disabled"),c("#"+e).devbridgeAutocomplete("clearCache"),c(this).remove()})},c(a.init)}(window,document,jQuery,window.CMB2Ext,window.CMB2);